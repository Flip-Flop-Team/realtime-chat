{"version":3,"sources":["ChatController.js"],"names":["tbl_chats","require","tbl_chat_user","tbl_users","getCatch","module","exports","registerChat","req","res","title","body","chat","create","catch","err","json","listChats","chats","findAll","raw","insertUsers","id_users","id_chat","response","insertion","id_user","fk_id_user","fk_id_chat","listChatUsers","id","params","chat_users","where","users","chat_user","user","findOne","push","deleteChat","destroy","deleteChatUsers","remove"],"mappings":"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","sourcesContent":["const tbl_chats = require('../models/tbl_chats')\r\nconst tbl_chat_user = require('../models/tbl_chat_user')\r\nconst tbl_users = require('../models/tbl_users')\r\nconst getCatch = require('../utils/getCatch')\r\n\r\nmodule.exports = {\r\n    registerChat: async(req, res) => {\r\n        const { title } = req.body\r\n        const chat = await tbl_chats.create({title})\r\n        .catch(err => getCatch(err))\r\n        return res.json(chat)\r\n    },\r\n    listChats: async(req, res) => {\r\n        const chats = await tbl_chats.findAll({raw: true})\r\n        .catch(err => getCatch(err))\r\n        return res.json(chats)\r\n    },\r\n    insertUsers: async(req, res) => {\r\n        const {id_users, id_chat} = req.body\r\n        const response = {}\r\n        response.insertion = []\r\n        for(id_user in id_users){\r\n            response.insertion[id_user] = await tbl_chat_user.create({\r\n                fk_id_user: id_users[id_user],\r\n                fk_id_chat: id_chat\r\n            }).catch(err => getCatch(err))\r\n        }\r\n        return res.json(response.insertion)\r\n    },\r\n    listChatUsers: async(req, res) => {\r\n        const id = req.params.id\r\n        const chat_users = await tbl_chat_user.findAll({where:{fk_id_chat : id}, raw: true})\r\n        .catch(err => getCatch(err))\r\n        if(chat_users === 0) return res.json(chat_users)\r\n        const users = []\r\n        for(chat_user of chat_users){\r\n            const user = await tbl_users.findOne({where: {id_user: chat_user.fk_id_user}})\r\n            .catch(err => getCatch(err))\r\n            if (user !== 0) users.push(user) \r\n        }\r\n        return res.json(users)\r\n    },\r\n    deleteChat: async(req, res) => {\r\n        const id = req.params.id\r\n        const response = await tbl_chats.destroy({where:{id_chat : id}})\r\n        .catch(err => getCatch(err))\r\n        return res.json(response)\r\n    },\r\n    deleteChatUsers: async(req, res) => {\r\n        const {id_users, id_chat} = req.body\r\n        const response = {}\r\n        response.remove = []\r\n        for (id_user in id_users) {\r\n            response.remove[id_user] = await tbl_chat_user.destroy({where:{\r\n                fk_id_user : id_users[id_user],\r\n                fk_id_chat : id_chat\r\n            }})\r\n            .catch(err => getCatch(err))\r\n        }\r\n        return res.json(response.remove)\r\n    }\r\n}"]}