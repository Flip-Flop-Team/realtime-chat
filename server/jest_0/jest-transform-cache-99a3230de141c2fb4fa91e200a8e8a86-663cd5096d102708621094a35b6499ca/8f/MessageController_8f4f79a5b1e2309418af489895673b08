3001815fddfba704503f4c048fc99d44
const tbl_messages = require('../models/tbl_messages');

const tbl_users = require('../models/tbl_users');

const getCatch = require('../utils/getCatch');

module.exports = {
  sendMenssage: async (req, res) => {
    const {
      content,
      fk_id_user,
      fk_id_chat
    } = req.body;
    const message = await tbl_messages.create({
      content,
      fk_id_chat,
      fk_id_user
    }).catch(err => getCatch(err));
    return res.json(message);
  },
  getMessages: async (req, res) => {
    const id_chat = req.params.id;
    const messages = await tbl_messages.findAll({
      where: {
        fk_id_chat: id_chat
      }
    }).catch(err => getCatch(err));

    for (message of messages) {
      message.username = await tbl_users.finOne({
        where: {
          id_users: message.fk_id_user
        }
      }).then(user => user.username).catch(err => getCatch(err));
    }

    return res.json(messages);
  },
  deleteMessage: async (req, res) => {
    const id_message = req.params.id;
    const response = await tbl_messages.destroy({
      where: {
        id_message
      }
    }).catch(err => getCatch(err));
    return res.json(response);
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk1lc3NhZ2VDb250cm9sbGVyLmpzIl0sIm5hbWVzIjpbInRibF9tZXNzYWdlcyIsInJlcXVpcmUiLCJ0YmxfdXNlcnMiLCJnZXRDYXRjaCIsIm1vZHVsZSIsImV4cG9ydHMiLCJzZW5kTWVuc3NhZ2UiLCJyZXEiLCJyZXMiLCJjb250ZW50IiwiZmtfaWRfdXNlciIsImZrX2lkX2NoYXQiLCJib2R5IiwibWVzc2FnZSIsImNyZWF0ZSIsImNhdGNoIiwiZXJyIiwianNvbiIsImdldE1lc3NhZ2VzIiwiaWRfY2hhdCIsInBhcmFtcyIsImlkIiwibWVzc2FnZXMiLCJmaW5kQWxsIiwid2hlcmUiLCJ1c2VybmFtZSIsImZpbk9uZSIsImlkX3VzZXJzIiwidGhlbiIsInVzZXIiLCJkZWxldGVNZXNzYWdlIiwiaWRfbWVzc2FnZSIsInJlc3BvbnNlIiwiZGVzdHJveSJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsWUFBWSxHQUFHQyxPQUFPLENBQUMsd0JBQUQsQ0FBNUI7O0FBQ0EsTUFBTUMsU0FBUyxHQUFHRCxPQUFPLENBQUMscUJBQUQsQ0FBekI7O0FBQ0EsTUFBTUUsUUFBUSxHQUFHRixPQUFPLENBQUMsbUJBQUQsQ0FBeEI7O0FBRUFHLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQjtBQUNiQyxFQUFBQSxZQUFZLEVBQUUsT0FBTUMsR0FBTixFQUFXQyxHQUFYLEtBQW1CO0FBQzdCLFVBQU07QUFBQ0MsTUFBQUEsT0FBRDtBQUFVQyxNQUFBQSxVQUFWO0FBQXNCQyxNQUFBQTtBQUF0QixRQUFvQ0osR0FBRyxDQUFDSyxJQUE5QztBQUNBLFVBQU1DLE9BQU8sR0FBRyxNQUFNYixZQUFZLENBQUNjLE1BQWIsQ0FBb0I7QUFBQ0wsTUFBQUEsT0FBRDtBQUFVRSxNQUFBQSxVQUFWO0FBQXNCRCxNQUFBQTtBQUF0QixLQUFwQixFQUNyQkssS0FEcUIsQ0FDZkMsR0FBRyxJQUFJYixRQUFRLENBQUNhLEdBQUQsQ0FEQSxDQUF0QjtBQUVBLFdBQU9SLEdBQUcsQ0FBQ1MsSUFBSixDQUFTSixPQUFULENBQVA7QUFDSCxHQU5ZO0FBT2JLLEVBQUFBLFdBQVcsRUFBRSxPQUFNWCxHQUFOLEVBQVdDLEdBQVgsS0FBbUI7QUFDNUIsVUFBTVcsT0FBTyxHQUFHWixHQUFHLENBQUNhLE1BQUosQ0FBV0MsRUFBM0I7QUFDQSxVQUFNQyxRQUFRLEdBQUcsTUFBTXRCLFlBQVksQ0FBQ3VCLE9BQWIsQ0FBcUI7QUFBQ0MsTUFBQUEsS0FBSyxFQUFDO0FBQUNiLFFBQUFBLFVBQVUsRUFBRVE7QUFBYjtBQUFQLEtBQXJCLEVBQ3RCSixLQURzQixDQUNoQkMsR0FBRyxJQUFJYixRQUFRLENBQUNhLEdBQUQsQ0FEQyxDQUF2Qjs7QUFFQSxTQUFJSCxPQUFKLElBQWVTLFFBQWYsRUFBeUI7QUFDckJULE1BQUFBLE9BQU8sQ0FBQ1ksUUFBUixHQUFtQixNQUFNdkIsU0FBUyxDQUFDd0IsTUFBVixDQUFpQjtBQUFDRixRQUFBQSxLQUFLLEVBQUU7QUFBQ0csVUFBQUEsUUFBUSxFQUFFZCxPQUFPLENBQUNIO0FBQW5CO0FBQVIsT0FBakIsRUFDcEJrQixJQURvQixDQUNmQyxJQUFJLElBQUlBLElBQUksQ0FBQ0osUUFERSxFQUVwQlYsS0FGb0IsQ0FFZEMsR0FBRyxJQUFJYixRQUFRLENBQUNhLEdBQUQsQ0FGRCxDQUF6QjtBQUdIOztBQUNELFdBQU9SLEdBQUcsQ0FBQ1MsSUFBSixDQUFTSyxRQUFULENBQVA7QUFDSCxHQWpCWTtBQWtCYlEsRUFBQUEsYUFBYSxFQUFFLE9BQU12QixHQUFOLEVBQVdDLEdBQVgsS0FBbUI7QUFDOUIsVUFBTXVCLFVBQVUsR0FBR3hCLEdBQUcsQ0FBQ2EsTUFBSixDQUFXQyxFQUE5QjtBQUNBLFVBQU1XLFFBQVEsR0FBRyxNQUFNaEMsWUFBWSxDQUFDaUMsT0FBYixDQUFxQjtBQUFDVCxNQUFBQSxLQUFLLEVBQUM7QUFBQ08sUUFBQUE7QUFBRDtBQUFQLEtBQXJCLEVBQ2xCaEIsS0FEa0IsQ0FDWkMsR0FBRyxJQUFJYixRQUFRLENBQUNhLEdBQUQsQ0FESCxDQUF2QjtBQUVBLFdBQU9SLEdBQUcsQ0FBQ1MsSUFBSixDQUFTZSxRQUFULENBQVA7QUFDSDtBQXZCWSxDQUFqQiIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHRibF9tZXNzYWdlcyA9IHJlcXVpcmUoJy4uL21vZGVscy90YmxfbWVzc2FnZXMnKVxyXG5jb25zdCB0YmxfdXNlcnMgPSByZXF1aXJlKCcuLi9tb2RlbHMvdGJsX3VzZXJzJylcclxuY29uc3QgZ2V0Q2F0Y2ggPSByZXF1aXJlKCcuLi91dGlscy9nZXRDYXRjaCcpXHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHtcclxuICAgIHNlbmRNZW5zc2FnZTogYXN5bmMocmVxLCByZXMpID0+IHtcclxuICAgICAgICBjb25zdCB7Y29udGVudCwgZmtfaWRfdXNlciwgZmtfaWRfY2hhdH0gPSByZXEuYm9keVxyXG4gICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBhd2FpdCB0YmxfbWVzc2FnZXMuY3JlYXRlKHtjb250ZW50LCBma19pZF9jaGF0LCBma19pZF91c2VyfSlcclxuICAgICAgICAuY2F0Y2goZXJyID0+IGdldENhdGNoKGVycikpXHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKG1lc3NhZ2UpXHJcbiAgICB9LFxyXG4gICAgZ2V0TWVzc2FnZXM6IGFzeW5jKHJlcSwgcmVzKSA9PiB7XHJcbiAgICAgICAgY29uc3QgaWRfY2hhdCA9IHJlcS5wYXJhbXMuaWRcclxuICAgICAgICBjb25zdCBtZXNzYWdlcyA9IGF3YWl0IHRibF9tZXNzYWdlcy5maW5kQWxsKHt3aGVyZTp7ZmtfaWRfY2hhdDogaWRfY2hhdH19KVxyXG4gICAgICAgIC5jYXRjaChlcnIgPT4gZ2V0Q2F0Y2goZXJyKSlcclxuICAgICAgICBmb3IobWVzc2FnZSBvZiBtZXNzYWdlcykge1xyXG4gICAgICAgICAgICBtZXNzYWdlLnVzZXJuYW1lID0gYXdhaXQgdGJsX3VzZXJzLmZpbk9uZSh7d2hlcmU6IHtpZF91c2VyczogbWVzc2FnZS5ma19pZF91c2VyfX0pXHJcbiAgICAgICAgICAgICAgICAudGhlbih1c2VyID0+IHVzZXIudXNlcm5hbWUpXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXJyID0+IGdldENhdGNoKGVycikpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXMuanNvbihtZXNzYWdlcylcclxuICAgIH0sXHJcbiAgICBkZWxldGVNZXNzYWdlOiBhc3luYyhyZXEsIHJlcykgPT4ge1xyXG4gICAgICAgIGNvbnN0IGlkX21lc3NhZ2UgPSByZXEucGFyYW1zLmlkXHJcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0YmxfbWVzc2FnZXMuZGVzdHJveSh7d2hlcmU6e2lkX21lc3NhZ2V9fSlcclxuICAgICAgICAgICAgLmNhdGNoKGVyciA9PiBnZXRDYXRjaChlcnIpKVxyXG4gICAgICAgIHJldHVybiByZXMuanNvbihyZXNwb25zZSlcclxuICAgIH0sXHJcbn0iXX0=